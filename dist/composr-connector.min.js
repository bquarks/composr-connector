!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.composrCR=t():e.composrCR=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=r(1);Object.keys(s).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=r(4);Object.defineProperty(t,"AuthRequest",{enumerable:!0,get:function(){return n(o)["default"]}});var i=r(5);Object.defineProperty(t,"AuthPersist",{enumerable:!0,get:function(){return n(i)["default"]}});var a=r(6);Object.defineProperty(t,"AuthConnector",{enumerable:!0,get:function(){return n(a)["default"]}});var u=r(7);Object.defineProperty(t,"Connect",{enumerable:!0,get:function(){return n(u)["default"]}})},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function s(e){return e.replace("{{module}}","composr")}function o(e){if(e.ok)return e.json()["catch"](function(){return e});var t=new Error(e.statusText);throw t.status=e.status,t.response=e,t}function i(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)});return t}Object.defineProperty(t,"__esModule",{value:!0}),t.jwt=void 0,t.buildURI=s,t.checkStatus=o,t.generateUUID=i;var a=r(2),u=n(a);t.jwt=u},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function s(e,t,r){if(e=e||{},e.exp=e.exp||a(),!e.iss)throw new Error("jwt:undefined:iss");if(!e.aud)throw new Error("jwt:undefined:aud");return i(e,t,r)}function o(e){var t=e.split(".");try{t[0]=JSON.parse(atob(t[0]))}catch(r){t[0]=!1}try{t[1]=JSON.parse(atob(t[1]))}catch(r){t[1]=!1}if(!t[0]&&!t[1])throw new Error("corbel:jwt:decode:invalid_assertion");return t[0]=t[0]||{},t[1]=t[1]||{},Object.keys(t[1]).forEach(function(e){t[0][e]=t[1][e]}),t[0]}function i(e,t,r){r=r||l;var n=["iss","aud","exp","scope","prn","version","refresh_token","request_domain","basic_auth.username","basic_auth.password","device_id"],s={};n.forEach(function(t){e[t]&&(s[t]=e[t])}),Object.assign(s,e),Array.isArray(s.scope)&&(s.scope=s.scope.join(" "));var o=c.rstr2b64(c.str2rstr_utf8(JSON.stringify({typ:f,alg:r}))),i=c.rstr2b64(c.str2rstr_utf8(JSON.stringify(s))),a=o+"."+i,u=c.b64tob64u(c.b64_hmac_sha256(t,a));return a+"."+u}function a(){return Math.round((new Date).getTime()/1e3)+h}Object.defineProperty(t,"__esModule",{value:!0}),t.generate=s,t.decode=o;var u=r(3),c=n(u),h=3500,l="HS256",f="JWT"},function(e,t){"use strict";function r(e,t){return s(n(o(e),o(t)))}function n(e,t){var r=i(e);r.length>16&&(r=k(r,8*e.length));for(var n=Array(16),s=Array(16),o=0;16>o;o++)n[o]=909522486^r[o],s[o]=1549556828^r[o];var u=k(n.concat(i(t)),512+8*t.length);return a(k(s.concat(u),768))}function s(e){try{}catch(t){_=""}for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",s=e.length,o=0;s>o;o+=3)for(var i=e.charCodeAt(o)<<16|(s>o+1?e.charCodeAt(o+1)<<8:0)|(s>o+2?e.charCodeAt(o+2):0),a=0;4>a;a++)n+=8*o+6*a>8*e.length?_:r.charAt(i>>>6*(3-a)&63);return n}function o(e){for(var t,r,n="",s=-1;++s<e.length;)t=e.charCodeAt(s),r=s+1<e.length?e.charCodeAt(s+1):0,t>=55296&&56319>=t&&r>=56320&&57343>=r&&(t=65536+((1023&t)<<10)+(1023&r),s++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}function i(e){for(var t=Array(e.length>>2),r=0;r<t.length;r++)t[r]=0;for(var r=0;r<8*e.length;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<24-r%32;return t}function a(e){for(var t="",r=0;r<32*e.length;r+=8)t+=String.fromCharCode(e[r>>5]>>>24-r%32&255);return t}function u(e,t){return e>>>t|e<<32-t}function c(e,t){return e>>>t}function h(e,t,r){return e&t^~e&r}function l(e,t,r){return e&t^e&r^t&r}function f(e){return u(e,2)^u(e,13)^u(e,22)}function d(e){return u(e,6)^u(e,11)^u(e,25)}function v(e){return u(e,7)^u(e,18)^c(e,3)}function p(e){return u(e,17)^u(e,19)^c(e,10)}function k(e,t){var r,n,s,o,i,a,u,c,k,m,y,_,x=new Array(1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225),S=new Array(64);for(e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t,k=0;k<e.length;k+=16){for(r=x[0],n=x[1],s=x[2],o=x[3],i=x[4],a=x[5],u=x[6],c=x[7],m=0;64>m;m++)16>m?S[m]=e[m+k]:S[m]=g(g(g(p(S[m-2]),S[m-7]),v(S[m-15])),S[m-16]),y=g(g(g(g(c,d(i)),h(i,a,u)),b[m]),S[m]),_=g(f(r),l(r,n,s)),c=u,u=a,a=i,i=g(o,y),o=s,s=n,n=r,r=g(y,_);x[0]=g(r,x[0]),x[1]=g(n,x[1]),x[2]=g(s,x[2]),x[3]=g(o,x[3]),x[4]=g(i,x[4]),x[5]=g(a,x[5]),x[6]=g(u,x[6]),x[7]=g(c,x[7])}return x}function g(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}function m(){}function y(e){return e=e.replace(/\=/g,""),e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_")}Object.defineProperty(t,"__esModule",{value:!0}),t.b64_hmac_sha256=r,t.rstr_hmac_sha256=n,t.rstr2b64=s,t.str2rstr_utf8=o,t.rstr2binb=i,t.binb2rstr=a,t.sha256_S=u,t.sha256_R=c,t.sha256_Ch=h,t.sha256_Sigma0256=f,t.sha256_Sigma1256=d,t.sha256_Gamma0256=v,t.sha256_Gamma1256=p,t.binb_sha256=k,t.safe_add=g,t.Base64x=m,t.b64tob64u=y;var _="",b=new Array(1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998)},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=n(i),u=function(){function e(t){s(this,e),this.authConfig=t}return o(e,[{key:"_createClaims",value:function(e,t){var r=this.authConfig,n=r.clientId,s=r.iamAUD,o=r.scopes,i=r.defaultAuthData,a={iss:n,aud:s,scope:o[t]};return Object.assign(a,i),Object.assign(a,e),a}},{key:"_generateAssertion",value:function(e,t){return a.jwt.generate(e,t)}},{key:"_authenticate",value:function(e,t,r){var n=this.authConfig,s=n.endpoints,o=n.urlBase,i=n.clientSecret,u=n.defaultHeaders,c=a.buildURI(o)+s[e],h=this._generateAssertion(t,i),l={jwt:h},f={Accept:"application/json","Content-Type":"application/json; charset=utf-8"};Object.assign(f,u),Object.assign(f,r);var d=new Headers(f),v=new Request(c,{credentials:"same-origin",mode:"cors",cache:"no-store",method:"POST",headers:d,body:JSON.stringify(l)});return fetch(v).then(a.checkStatus)}},{key:"authenticateClient",value:function(){var e=this._createClaims({},"client");return this.clientAccessTokenPromise=this._authenticate("loginClient",e),this.clientAccessTokenPromise}},{key:"authenticateUser",value:function(e){var t=e.email,r=e.password,n=e.headersExtension,s=void 0===n?{}:n,o=e.authDataExtension,i=void 0===o?{}:o,a=Object.assign({"basic_auth.username":t,"basic_auth.password":r},i),u=this._createClaims(a,"user"),c=this._authenticate("login",u,s);return c}},{key:"refreshUserToken",value:function(e){var t=e.refreshToken,r=e.headersExtension,n=void 0===r?{}:r,s=e.authDataExtension,o=void 0===s?{}:s,i=Object.assign({refresh_token:t},o),a=this._createClaims(i,"user"),u=this._authenticate("refreshToken",a,n);return u}},{key:"logoutUser",value:function(e){var t=e.accessToken,r=e.headersExtension,n=void 0===r?{}:r,s=e.authDataExtension,o=void 0===s?{}:s,i=Object.assign({Authorization:t},n),a=this._createClaims(o,"user"),u=this._authenticate("logout",a,i);return u}}]),e}();t["default"]=u},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];r(this,e),this._isNode(),this.getRememberFromStorage(),this.getTokensFromStorage(),this.cookies=t}return n(e,[{key:"_isNode",value:function(){var e=new Function("try {return window;}catch(e){ return false;}");return e()?(this.sessionStorage=window.sessionStorage,this.localStorage=window.localStorage,!1):(this.sessionStorage={removeItem:function(e){this[e]=void 0}},this.localStorage={removeItem:function(e){this[e]=void 0}},!0)}},{key:"_addLocalStorage",value:function(e){this.remember&&(this.localStorage.remember=!0,this.localStorage.refreshToken=e.refreshToken),e.authOptions&&(this.localStorage.authOptions=JSON.stringify(e.authOptions)),this.localStorage.accessToken=e.accessToken,this.localStorage.expiresAt=e.expiresAt}},{key:"_addSessionStorage",value:function(e){this.remember&&(this.sessionStorage.remember=!0),e.authOptions&&(this.sessionStorage.authOptions=JSON.stringify(e.authOptions)),this.sessionStorage.refreshToken=e.refreshToken,this.sessionStorage.accessToken=e.accessToken,this.sessionStorage.expiresAt=e.expiresAt}},{key:"_removeLocalStorage",value:function(){this.localStorage.removeItem("refreshToken"),this.localStorage.removeItem("accessToken"),this.localStorage.removeItem("expiresAt"),this.localStorage.removeItem("remember"),this.localStorage.removeItem("authOptions")}},{key:"_removeSessionStorage",value:function(){this.sessionStorage.removeItem("refreshToken"),this.sessionStorage.removeItem("accessToken"),this.sessionStorage.removeItem("expiresAt"),this.sessionStorage.removeItem("remember"),this.sessionStorage.removeItem("authOptions")}},{key:"_removeUserCookie",value:function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},{key:"_removeUserCookies",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,s=this.cookies[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=n.value;this._removeUserCookie(o)}}catch(i){t=!0,r=i}finally{try{!e&&s["return"]&&s["return"]()}finally{if(t)throw r}}}},{key:"_getAuthOptionsFromStorage",value:function(){var e=this.sessionStorage.authOptions||this.localStorage.authOptions;try{e=JSON.parse(e)}catch(t){e={}}return e}},{key:"_getUserAccessToken",value:function(){var e={accessToken:this.sessionStorage.accessToken,expiresAt:parseInt(this.sessionStorage.expiresAt)},t={accessToken:this.localStorage.accessToken,expiresAt:parseInt(this.localStorage.expiresAt)},r={};return r=isNaN(e.expiresAt)||isNaN(t.expiresAt)?isNaN(e.expiresAt)?t:e:e.expiresAt>t.expiresAt?e:t}},{key:"_getUserTokens",value:function(){var e=this.sessionStorage.refreshToken||this.localStorage.refreshToken,t=this._getUserAccessToken(),r=t.accessToken,n=t.expiresAt,s={refreshToken:e,accessToken:r,expiresAt:n};return s}},{key:"_getClientAccessToken",value:function(){var e=this.sessionStorage.clientAccessToken,t=this.sessionStorage.clientExpiresAt;return{accessToken:e,expiresAt:t}}},{key:"persistClientToken",value:function(e){var t=e.accessToken,r=e.expiresAt;this.sessionStorage.clientAccessToken=t,this.sessionStorage.clientExpiresAt=r,this.tokens.client={accessToken:t,expiresAt:r}}},{key:"persistAuthData",value:function(e){var t=e.accessToken,r=e.refreshToken,n=e.expiresAt,s=e.authOptions;return this.remember?(this._addLocalStorage(e),this._addSessionStorage(e)):this._addSessionStorage(e),this.tokens.user={accessToken:t,refreshToken:r,expiresAt:n},this.tokens.authOptions=s,!0}},{key:"removeAllUserData",value:function(){this._removeLocalStorage(),this._removeSessionStorage(),this._removeUserCookies()}},{key:"getRememberFromStorage",value:function(){var e=this.sessionStorage.remember||this.localStorage.remember;return this.remember="true"===e,this.remember}},{key:"getTokensFromStorage",value:function(){var e={client:this._getClientAccessToken(),user:this._getUserTokens(),authOptions:this._getAuthOptionsFromStorage()};return this.tokens=e,e}}]),e}();t["default"]=s},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(4),u=s(a),c=r(5),h=s(c),l=r(1),f=(n(l),function(){function e(t){var r=t.options,n=void 0===r?{}:r,s=t.authConfig,i=t.authPersist,a=void 0===i?new h["default"]:i,c=t.authRequest,l=void 0===c?new u["default"](s):c;o(this,e),this.authPersist=a,this.authRequest=l,this.options=n,this.userAuthenticated=!1}return i(e,[{key:"_validateAccessToken",value:function(){this.authPersist.getTokensFromStorage();var e=this.authPersist.tokens.user,t=e.accessToken,r=e.expiresAt,n=e.refreshToken,s=t&&r&&Date.now()<r,o=void 0;return o=s?Promise.resolve({accessToken:t}):n?this.refreshUserToken():Promise.reject("No accessToken or refreshToken")}},{key:"_validateClientAccessToken",value:function(e){var t=e&&e.accessToken&&e.expiresAt&&Date.now()<parseInt(e.expiresAt);return t?e:!1}},{key:"_parseTokenObject",value:function(e){return e.tokenObject?e.tokenObject:e}},{key:"_executePromiseCb",value:function(e,t){if(this.options.callbacks){var r=void 0,n=void 0;this.options.callbacks.success&&(r=this.options.callbacks.success[e]),this.options.callbacks.error&&(n=this.options.callbacks.error[e]),t.then(r)["catch"](n)}}},{key:"init",value:function(){var e=this;this.loginClient(),this.authValidation().then(function(){return e.userAuthenticated=!0})["catch"](function(){return e.userAuthenticated=!1})}},{key:"authValidation",value:function(){var e=this;if(this.validationPromise&&"Pending"===this._validationState)return this.validationPromise;this._validationState="Pending";var t=this._validateAccessToken();return t.then(function(){return e._validationState="Resolved"})["catch"](function(){return e._validationState="Resolved"}),this.validationPromise=t,t}},{key:"getCurrentToken",value:function(){var e=this;this.authPersist.getTokensFromStorage();var t=this.authValidation().then(function(){var t=e.authPersist.tokens.user.accessToken;return t&&e.userAuthenticated===!1&&(e.userAuthenticated=!0),t})["catch"](function(){return e.loginClient().then(e._parseTokenObject).then(function(e){return e.accessToken})});return t}},{key:"loginClient",value:function(){var e=this;this.authPersist.getTokensFromStorage();var t=this.authPersist.tokens.client,r=this._validateClientAccessToken(t);if(r)return Promise.resolve(r);var n=this.authRequest.authenticateClient().then(this._parseTokenObject).then(function(t){return e.authPersist.persistClientToken(t),t});return this._executePromiseCb("loginClient",n),this.clientAccessTokenPromise=n,n}},{key:"loginUser",value:function(e){var t=this,r=e.email,n=e.password,s=e.remember,o=this.options,i=o.authDataExtension,a=void 0===i?{}:i,u=o.headersExtension,c=void 0===u?{}:u,h=this.authRequest.authenticateUser({email:r,password:n,remember:s,headersExtension:c,authDataExtension:a}).then(this._parseTokenObject).then(function(e){return e.authOptions=t.options,t.authPersist.remember=s?s:!1,t.authPersist.persistAuthData(e),t.userAuthenticated=!0,e});return this._executePromiseCb("loginUser",h),this.loginUserPromise=h,h}},{key:"refreshUserToken",value:function(){var e=this;this.authPersist.getTokensFromStorage();var t=this.authPersist.tokens.user.refreshToken,r=this.authPersist.tokens.authOptions,n=r.authDataExtension,s=void 0===n?{}:n,o=r.headersExtension,i=void 0===o?{}:o,a=this.authRequest.refreshUserToken({refreshToken:t,headersExtension:i,authDataExtension:s}).then(this._parseTokenObject).then(function(t){return e.authPersist.persistAuthData(t),e.userAuthenticated=!0,t});return this._executePromiseCb("refreshUserToken",a),this.refreshUserTokenPromise=a,a}},{key:"logoutUser",value:function(){this.authPersist.getTokensFromStorage();var e=this.authPersist.tokens.user.accessToken,t=this.authPersist.tokens.authOptions,r=t.authDataExtension,n=void 0===r?{}:r,s=t.headersExtension,o=void 0===s?{}:s,i=this.authRequest.logoutUser({accessToken:e,headersExtension:o,authDataExtension:n});return this.userAuthenticated=!1,this.authPersist.removeAllUserData(),this._executePromiseCb("logoutUser",i),i}}]),e}());t["default"]=f},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(6),u=s(a),c=r(1),h=n(c),l=function(){function e(t){var r=t.config,n=t.options,s=void 0===n?{}:n,i=t.authConnector,a=void 0===i?new u["default"]({authConfig:r}):i;o(this,e),this.authConnector=a,this.endpoints=r.endpoints,this.urlBase=r.urlBase,this.options=s,this._requestDataQueue=[],this.authConnector.init()}return i(e,[{key:"_buildHeaders",value:function(e){var t=e.token,r=e.headersExtension,n={Accept:"application/json","Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+t},s=Object.assign(n,this.options.headersExtension,r);return new Headers(s)}},{key:"_buildRequestParams",value:function(e){var t=e.body,r=e.queryParams,n=this._buildQueryPath(r);return t&&(t=JSON.stringify(t)),{body:t,queryPath:n}}},{key:"_buildQueryPath",value:function(e){var t="";if(e){var r=[];Object.keys(e).forEach(function(t){r.push(t+"="+e[t])}),r.length>0&&(t="?"+r.join("&"))}return t}},{key:"_buildUrl",value:function(e){var t=e.endpoint,r=e.queryPath,n=this.endpoints[t];t.key&&(n=this.endpoints[t.key]+t.id);var s=h.buildURI(this.urlBase)+n+r;return s}},{key:"_buildRequest",value:function(e,t){var r=e.endpoint,n=e.method,s=e.params,o=e.data,i=e.headersExtension,a=this._buildRequestParams({queryParams:s,body:o}),u=a.body,c=a.queryPath,l=this._buildUrl({endpoint:r,queryPath:c}),f=this._buildHeaders({token:t,headersExtension:i}),d=new Request(l,{credentials:"same-origin",mode:"cors",cache:"no-store",method:n,headers:f,body:u});return fetch(d).then(h.checkStatus)}},{key:"_createRetryRequests",value:function(e){var t=e.accessToken,r=void 0,n=void 0,s=[];if(this.options.retryRequestProxy){var o=this.options.retryRequestProxy(e,this._requestDataQueue);r=o.requestDataQueue,n=o.requestsCallback}else r=this._requestDataQueue,n=function(e){return e};var i=!0,a=!1,u=void 0;try{for(var c,h=r[Symbol.iterator]();!(i=(c=h.next()).done);i=!0){var l=c.value,f=this._buildRequest(l,t);s.push(f)}}catch(d){a=!0,u=d}finally{try{!i&&h["return"]&&h["return"]()}finally{if(a)throw u}}return this._requestDataQueue=[],Promise.all(s).then(n)}},{key:"_retry",value:function(e){var t=this;if(this._requestDataQueue.push(e),"Pending"===this._retryStatus)return this._retryRequest;var r=this.authConnector.refreshUserToken();return this._retryRequest=r.then(function(e){return t._createRetryRequests(e)}),r.then(function(){return t._retryStatus="Resolved"})["catch"](function(){return t._retryStatus="Resolved"}),this._retryRequest}},{key:"_request",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this.authConnector.getCurrentToken().then(function(r){var n=t._buildRequest(e,r);return n})["catch"](function(n){if(r&&401===n.status&&t.authConnector.userAuthenticated)return t._retry(e);throw n});return n}},{key:"request",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(this.options.requestProxy){var r=this.options.requestProxy;return r(this._request,e,t)}return this._request(e,t)}},{key:"get",value:function(e,t){var r={method:"get",endpoint:e,params:t};return this.request(r)}},{key:"delete",value:function(e,t){var r={method:"delete",endpoint:e,params:t};return this.request(r)}},{key:"post",value:function(e,t){var r={method:"post",endpoint:e,data:t};return this.request(r)}},{key:"put",value:function(e,t){var r={method:"put",endpoint:e,data:t};return this.request(r)}}]),e}();t["default"]=l}])});
//# sourceMappingURL=composr-connector.min.js.map
