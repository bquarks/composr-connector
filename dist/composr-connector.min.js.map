{"version":3,"sources":["composr-connector.min.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_utils","keys","forEach","key","enumerable","get","_AuthRequest","_AuthPersist","_AuthConnector","_Connect","_interopRequireWildcard","newObj","prototype","hasOwnProperty","buildURI","urlBase","replace","checkStatus","response","ok","json","error","Error","statusText","status","generateUUID","d","Date","getTime","uuid","r","Math","random","floor","toString","jwt","undefined","_events","_jwt","topics","hOP","events","subscribe","topic","listener","index","push","remove","publish","info","item","generate","claims","secret","alg","exp","_generateExp","iss","aud","_generate","decode","assertion","decoded","split","JSON","parse","atob","e","ALGORITHM","claimsKeys","finalClaims","assign","Array","isArray","scope","join","bAlg","cryptography","rstr2b64","str2rstr_utf8","stringify","typ","TYP","bClaims","segment","b64tob64u","b64_hmac_sha256","round","EXPIRATION","_cryptography","k","rstr_hmac_sha256","data","bkey","rstr2binb","length","binb_sha256","ipad","opad","i","hash","concat","binb2rstr","input","b64pad","tab","output","len","triplet","charCodeAt","j","charAt","x","y","String","fromCharCode","sha256_S","X","n","sha256_R","sha256_Ch","z","sha256_Maj","sha256_Sigma0256","sha256_Sigma1256","sha256_Gamma0256","sha256_Gamma1256","l","a","b","f","g","h","T1","T2","HASH","W","safe_add","sha256_K","lsw","msw","Base64x","s","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","configurable","writable","protoProps","staticProps","utils","AuthRequest","authConfig","authData","_authConfig","clientId","iamAUD","scopes","defaultAuthData","clientSecret","endpoint","headers","_authConfig2","endpoints","defaultHeaders","url","_generateAssertion","body","authenticationHeaders","Accept","Content-Type","headersInstance","Headers","request","Request","credentials","mode","cache","method","fetch","then","_createClaims","clientAccessTokenPromise","_authenticate","_ref","email","password","_ref$headersExtension","headersExtension","_ref$authDataExtensio","authDataExtension","basic_auth.username","basic_auth.password","_ref2","refreshToken","_ref2$headersExtensio","_ref2$authDataExtensi","refresh_token","_ref3","accessToken","_ref3$headersExtensio","_ref3$authDataExtensi","Authorization","AuthPersist","cookies","arguments","_isNode","getRememberFromStorage","getTokensFromStorage","evaluateEnvironment","Function","sessionStorage","window","localStorage","removeItem","remember","authOptions","expiresAt","items","cookieName","document","cookie","_removeUserCookie","err","sessionStorageToken","parseInt","localStorageToken","mostRecentToken","isNaN","_getUserAccessToken2","_getUserAccessToken","userTokens","clientAccessToken","clientExpiresAt","tokens","client","tokenObject","_addLocalStorage","_addSessionStorage","user","_removeLocalStorage","_removeSessionStorage","_removeUserCookies","_getClientAccessToken","_getUserTokens","_getAuthOptionsFromStorage","_AuthRequest2","_AuthPersist2","AuthConnector","_ref$options","options","_ref$authPersist","authPersist","_ref$authRequest","authRequest","userAuthenticated","auth","_authPersist$tokens$u","validAccessToken","now","accessTokenPromise","Promise","resolve","refreshUserToken","reject","clientToken","isValid","name","promise","_publishEvent","callbacks","successCb","errorCb","success","res","result","_this","loginClient","authValidation","_setAuthentication","_this2","validationPromise","_validationState","validationRequest","_validateAccessToken","_this3","currentTokenPromise","_parseTokenObject","_this4","storedClientToken","currentClientAccessToken","_validateClientAccessToken","authenticateClient","persistClientToken","_executePromiseCb","_this5","_options","_options$authDataExte","_options$headersExten","authenticateUser","persistAuthData","loginUserPromise","_this6","_authPersist$tokens$a","_authPersist$tokens$a2","_authPersist$tokens$a3","refreshUserTokenPromise","_authPersist$tokens$a4","_authPersist$tokens$a5","_authPersist$tokens$a6","logoutUser","removeAllUserData","_AuthConnector2","Connect","config","_ref$authConnector","authConnector","_requestDataQueue","init","token","queryParams","queryPath","_buildQueryPath","dict","query","queries","_ref4","requestEndpoint","_ref5","params","_buildRequestParams2","_buildRequestParams","_buildUrl","_buildHeaders","requestDataQueue","requestsCallback","retryRequests","retryRequestProxy","retryRequestProxyResponse","_buildRequest","all","requestData","_retryStatus","_retryRequest","refreshTokenPromise","_createRetryRequests","retry","fetchRequest","getCurrentToken","_retry","requestProxy","_request"],"mappings":"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","file":"composr-connector.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"composrCR\"] = factory();\n\telse\n\t\troot[\"composrCR\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _utils = __webpack_require__(1);\n\t\n\tObject.keys(_utils).forEach(function (key) {\n\t  if (key === \"default\" || key === \"__esModule\") return;\n\t  Object.defineProperty(exports, key, {\n\t    enumerable: true,\n\t    get: function get() {\n\t      return _utils[key];\n\t    }\n\t  });\n\t});\n\t\n\tvar _AuthRequest = __webpack_require__(5);\n\t\n\tObject.defineProperty(exports, 'AuthRequest', {\n\t  enumerable: true,\n\t  get: function get() {\n\t    return _interopRequireDefault(_AuthRequest).default;\n\t  }\n\t});\n\t\n\tvar _AuthPersist = __webpack_require__(6);\n\t\n\tObject.defineProperty(exports, 'AuthPersist', {\n\t  enumerable: true,\n\t  get: function get() {\n\t    return _interopRequireDefault(_AuthPersist).default;\n\t  }\n\t});\n\t\n\tvar _AuthConnector = __webpack_require__(7);\n\t\n\tObject.defineProperty(exports, 'AuthConnector', {\n\t  enumerable: true,\n\t  get: function get() {\n\t    return _interopRequireDefault(_AuthConnector).default;\n\t  }\n\t});\n\t\n\tvar _Connect = __webpack_require__(8);\n\t\n\tObject.defineProperty(exports, 'Connect', {\n\t  enumerable: true,\n\t  get: function get() {\n\t    return _interopRequireDefault(_Connect).default;\n\t  }\n\t});\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.jwt = undefined;\n\t\n\tvar _events = __webpack_require__(2);\n\t\n\tObject.keys(_events).forEach(function (key) {\n\t  if (key === \"default\" || key === \"__esModule\") return;\n\t  Object.defineProperty(exports, key, {\n\t    enumerable: true,\n\t    get: function get() {\n\t      return _events[key];\n\t    }\n\t  });\n\t});\n\texports.buildURI = buildURI;\n\texports.checkStatus = checkStatus;\n\texports.generateUUID = generateUUID;\n\t\n\tvar _jwt = __webpack_require__(3);\n\t\n\tvar jwt = _interopRequireWildcard(_jwt);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction buildURI(urlBase) {\n\t  return urlBase.replace('{{module}}', 'composr');\n\t}\n\t\n\tfunction checkStatus(response) {\n\t  if (response.ok) {\n\t    return response.json().catch(function () {\n\t      return response;\n\t    });\n\t  }\n\t\n\t  var error = new Error(response.statusText);\n\t  error.status = response.status;\n\t  error.response = response;\n\t  throw error;\n\t}\n\t\n\tfunction generateUUID() {\n\t  var d = new Date().getTime();\n\t  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n\t    var r = (d + Math.random() * 16) % 16 | 0;\n\t    d = Math.floor(d / 16);\n\t    return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n\t  });\n\t  return uuid;\n\t}\n\t\n\texports.jwt = jwt;\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t// Based on David Walsh's pub-sub implementation\n\t// https://davidwalsh.name/pubsub-javascript\n\t\n\tvar topics = {};\n\tvar hOP = topics.hasOwnProperty;\n\t\n\tvar events = exports.events = {\n\t  subscribe: function subscribe(topic, listener) {\n\t    // Create the topic's object if not yet created\n\t    if (!hOP.call(topics, topic)) {\n\t      topics[topic] = [];\n\t    }\n\t\n\t    // Add the listener to queue\n\t    var index = topics[topic].push(listener) - 1;\n\t\n\t    // Provide handle back for removal of topic\n\t    return {\n\t      remove: function remove() {\n\t        delete topics[topic][index];\n\t      }\n\t    };\n\t  },\n\t  publish: function publish(topic, info) {\n\t    // If the topic doesn't exist, or there's no listeners in queue, just leave\n\t    if (!hOP.call(topics, topic)) {\n\t      return;\n\t    }\n\t\n\t    // Cycle through topics queue, fire!\n\t    topics[topic].forEach(function (item) {\n\t      item(info != undefined ? info : {});\n\t    });\n\t  }\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.generate = generate;\n\texports.decode = decode;\n\t\n\tvar _cryptography = __webpack_require__(4);\n\t\n\tvar cryptography = _interopRequireWildcard(_cryptography);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\t/*\n\t * Extracted from Corbel-js: https://github.com/corbel-platform/corbel-js\n\t * Original module: https://github.com/corbel-platform/corbel-js/blob/master/src/jwt.js\n\t */\n\t// jscs:disable requireCamelCaseOrUpperCaseIdentifiers\n\t// TODO: Use ES6 syntax\n\tvar EXPIRATION = 3500;\n\tvar ALGORITHM = 'HS256';\n\tvar TYP = 'JWT';\n\tvar VERSION = '1.0.0';\n\t\n\t/**\n\t * JWT-HmacSHA256 generator\n\t * http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html\n\t *\n\t * @param  {Object}                                 claims Specific claims to include in the JWT (iss, aud, exp, scope, ...)\n\t * @param  {String} secret                          String with the client assigned secret\n\t * @param  {Object} [alg='corbel.jwt.ALGORITHM']    Object with the algorithm type\n\t * @return {String} jwt                             JWT string\n\t */\n\tfunction generate(claims, secret, alg) {\n\t  claims = claims || {};\n\t  claims.exp = claims.exp || _generateExp();\n\t\n\t  if (!claims.iss) {\n\t    throw new Error('jwt:undefined:iss');\n\t  }\n\t  if (!claims.aud) {\n\t    throw new Error('jwt:undefined:aud');\n\t  }\n\t\n\t  return _generate(claims, secret, alg);\n\t}\n\t\n\tfunction decode(assertion) {\n\t  var decoded = assertion.split('.');\n\t\n\t  try {\n\t    decoded[0] = JSON.parse(atob(decoded[0]));\n\t  } catch (e) {\n\t    decoded[0] = false;\n\t  }\n\t\n\t  try {\n\t    decoded[1] = JSON.parse(atob(decoded[1]));\n\t  } catch (e) {\n\t    decoded[1] = false;\n\t  }\n\t\n\t  if (!decoded[0] && !decoded[1]) {\n\t    throw new Error('corbel:jwt:decode:invalid_assertion');\n\t  }\n\t\n\t  decoded[0] = decoded[0] || {};\n\t  decoded[1] = decoded[1] || {};\n\t\n\t  Object.keys(decoded[1]).forEach(function (key) {\n\t    decoded[0][key] = decoded[1][key];\n\t  });\n\t\n\t  return decoded[0];\n\t}\n\t\n\tfunction _generate(claims, secret, alg) {\n\t  alg = alg || ALGORITHM;\n\t\n\t  // Ensure claims specific order\n\t  var claimsKeys = ['iss', 'aud', 'exp', 'scope', 'prn', 'version', 'refresh_token', 'request_domain', 'basic_auth.username', 'basic_auth.password', 'device_id'];\n\t\n\t  var finalClaims = {};\n\t  claimsKeys.forEach(function (key) {\n\t    if (claims[key]) {\n\t      finalClaims[key] = claims[key];\n\t    }\n\t  });\n\t\n\t  Object.assign(finalClaims, claims);\n\t\n\t  if (Array.isArray(finalClaims.scope)) {\n\t    finalClaims.scope = finalClaims.scope.join(' ');\n\t  }\n\t\n\t  var bAlg = cryptography.rstr2b64(cryptography.str2rstr_utf8(JSON.stringify({\n\t    typ: TYP,\n\t    alg: alg\n\t  })));\n\t  var bClaims = cryptography.rstr2b64(cryptography.str2rstr_utf8(JSON.stringify(finalClaims)));\n\t  var segment = bAlg + '.' + bClaims;\n\t  var assertion = cryptography.b64tob64u(cryptography.b64_hmac_sha256(secret, segment));\n\t\n\t  return segment + '.' + assertion;\n\t}\n\t\n\tfunction _generateExp() {\n\t  return Math.round(new Date().getTime() / 1000) + EXPIRATION;\n\t}\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.b64_hmac_sha256 = b64_hmac_sha256;\n\texports.rstr_hmac_sha256 = rstr_hmac_sha256;\n\texports.rstr2b64 = rstr2b64;\n\texports.str2rstr_utf8 = str2rstr_utf8;\n\texports.rstr2binb = rstr2binb;\n\texports.binb2rstr = binb2rstr;\n\texports.sha256_S = sha256_S;\n\texports.sha256_R = sha256_R;\n\texports.sha256_Ch = sha256_Ch;\n\texports.sha256_Sigma0256 = sha256_Sigma0256;\n\texports.sha256_Sigma1256 = sha256_Sigma1256;\n\texports.sha256_Gamma0256 = sha256_Gamma0256;\n\texports.sha256_Gamma1256 = sha256_Gamma1256;\n\texports.binb_sha256 = binb_sha256;\n\texports.safe_add = safe_add;\n\texports.Base64x = Base64x;\n\texports.b64tob64u = b64tob64u;\n\t/*************************************************************************************************\n\t * Extracted from Corbel-js: https://github.com/corbel-platform/corbel-js                        *\n\t * Original module: https://github.com/corbel-platform/corbel-js/blob/master/src/cryptography.js *\n\t *************************************************************************************************/\n\t\n\t/*********************************************************************************\n\t * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined *\n\t * in FIPS 180-2                                                                 *\n\t * Version 2.2 Copyright Angel Marin, Paul Johnston 2000 - 2009.                 *\n\t * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet                 *\n\t * Distributed under the BSD License                                             *\n\t * See http://pajhome.org.uk/crypt/md5 for details.                              *\n\t * Also http://anmar.eu.org/projects/jssha2/                                     *\n\t *********************************************************************************/\n\t// TODO: Use ES6 syntax\n\t/*\n\t * Configurable variables. You may need to tweak these to be compatible with\n\t * the server-side, but the defaults work in most cases.\n\t */\n\tvar hexcase = 0; /* hex output format. 0 - lowercase; 1 - uppercase        */\n\tvar b64pad = ''; /* base-64 pad character. \"=\" for strict RFC compliance   */\n\t\n\t/* jshint ignore:start */\n\t// jscs:disable\n\tvar sha256_K = new Array(1116352408, 1899447441, -1245643825, -373957723, 961987163, 1508970993, -1841331548, -1424204075, -670586216, 310598401, 607225278, 1426881987, 1925078388, -2132889090, -1680079193, -1046744716, -459576895, -272742522, 264347078, 604807628, 770255983, 1249150122, 1555081692, 1996064986, -1740746414, -1473132947, -1341970488, -1084653625, -958395405, -710438585, 113926993, 338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700, 1986661051, -2117940946, -1838011259, -1564481375, -1474664885, -1035236496, -949202525, -778901479, -694614492, -200395387, 275423344, 430227734, 506948616, 659060556, 883997877, 958139571, 1322822218, 1537002063, 1747873779, 1955562222, 2024104815, -2067236844, -1933114872, -1866530822, -1538233109, -1090935817, -965641998);\n\t\n\tfunction b64_hmac_sha256(k, d) {\n\t  return rstr2b64(rstr_hmac_sha256(str2rstr_utf8(k), str2rstr_utf8(d)));\n\t};\n\t\n\t/*\n\t * Calculate the HMAC-sha256 of a key and some data (raw strings)\n\t */\n\tfunction rstr_hmac_sha256(key, data) {\n\t  var bkey = rstr2binb(key);\n\t  if (bkey.length > 16) {\n\t    bkey = binb_sha256(bkey, key.length * 8);\n\t  }\n\t\n\t  var ipad = Array(16),\n\t      opad = Array(16);\n\t  for (var i = 0; i < 16; i++) {\n\t    ipad[i] = bkey[i] ^ 0x36363636;\n\t    opad[i] = bkey[i] ^ 0x5C5C5C5C;\n\t  }\n\t\n\t  var hash = binb_sha256(ipad.concat(rstr2binb(data)), 512 + data.length * 8);\n\t  return binb2rstr(binb_sha256(opad.concat(hash), 512 + 256));\n\t};\n\t\n\t/*\n\t * Convert a raw string to a base-64 string\n\t */\n\tfunction rstr2b64(input) {\n\t  try {\n\t    b64pad;\n\t  } catch (e) {\n\t    b64pad = '';\n\t  }\n\t  var tab = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\t  var output = '';\n\t  var len = input.length;\n\t  for (var i = 0; i < len; i += 3) {\n\t    var triplet = input.charCodeAt(i) << 16 | (i + 1 < len ? input.charCodeAt(i + 1) << 8 : 0) | (i + 2 < len ? input.charCodeAt(i + 2) : 0);\n\t    for (var j = 0; j < 4; j++) {\n\t      if (i * 8 + j * 6 > input.length * 8) output += b64pad;else output += tab.charAt(triplet >>> 6 * (3 - j) & 0x3F);\n\t    }\n\t  }\n\t  return output;\n\t};\n\t\n\t/*\n\t * Encode a string as utf-8.\n\t * For efficiency, this assumes the input is valid utf-16.\n\t */\n\tfunction str2rstr_utf8(input) {\n\t  var output = '';\n\t  var i = -1;\n\t  var x, y;\n\t\n\t  while (++i < input.length) {\n\t    /* Decode utf-16 surrogate pairs */\n\t    x = input.charCodeAt(i);\n\t    y = i + 1 < input.length ? input.charCodeAt(i + 1) : 0;\n\t    if (0xD800 <= x && x <= 0xDBFF && 0xDC00 <= y && y <= 0xDFFF) {\n\t      x = 0x10000 + ((x & 0x03FF) << 10) + (y & 0x03FF);\n\t      i++;\n\t    }\n\t\n\t    /* Encode output as utf-8 */\n\t    if (x <= 0x7F) output += String.fromCharCode(x);else if (x <= 0x7FF) output += String.fromCharCode(0xC0 | x >>> 6 & 0x1F, 0x80 | x & 0x3F);else if (x <= 0xFFFF) output += String.fromCharCode(0xE0 | x >>> 12 & 0x0F, 0x80 | x >>> 6 & 0x3F, 0x80 | x & 0x3F);else if (x <= 0x1FFFFF) output += String.fromCharCode(0xF0 | x >>> 18 & 0x07, 0x80 | x >>> 12 & 0x3F, 0x80 | x >>> 6 & 0x3F, 0x80 | x & 0x3F);\n\t  }\n\t  return output;\n\t};\n\t\n\t/*\n\t * Convert a raw string to an array of big-endian words\n\t * Characters >255 have their high-byte silently ignored.\n\t */\n\tfunction rstr2binb(input) {\n\t  var output = Array(input.length >> 2);\n\t  for (var i = 0; i < output.length; i++) {\n\t    output[i] = 0;\n\t  }for (var i = 0; i < input.length * 8; i += 8) {\n\t    output[i >> 5] |= (input.charCodeAt(i / 8) & 0xFF) << 24 - i % 32;\n\t  }return output;\n\t};\n\t\n\t/*\n\t * Convert an array of big-endian words to a string\n\t */\n\tfunction binb2rstr(input) {\n\t  var output = '';\n\t  for (var i = 0; i < input.length * 32; i += 8) {\n\t    output += String.fromCharCode(input[i >> 5] >>> 24 - i % 32 & 0xFF);\n\t  }return output;\n\t};\n\t\n\t/*\n\t * Main sha256 function, with its support functions\n\t */\n\tfunction sha256_S(X, n) {\n\t  return X >>> n | X << 32 - n;\n\t};\n\t\n\tfunction sha256_R(X, n) {\n\t  return X >>> n;\n\t};\n\t\n\tfunction sha256_Ch(x, y, z) {\n\t  return x & y ^ ~x & z;\n\t};\n\t\n\tfunction sha256_Maj(x, y, z) {\n\t  return x & y ^ x & z ^ y & z;\n\t};\n\t\n\tfunction sha256_Sigma0256(x) {\n\t  return sha256_S(x, 2) ^ sha256_S(x, 13) ^ sha256_S(x, 22);\n\t};\n\t\n\tfunction sha256_Sigma1256(x) {\n\t  return sha256_S(x, 6) ^ sha256_S(x, 11) ^ sha256_S(x, 25);\n\t};\n\t\n\tfunction sha256_Gamma0256(x) {\n\t  return sha256_S(x, 7) ^ sha256_S(x, 18) ^ sha256_R(x, 3);\n\t};\n\t\n\tfunction sha256_Gamma1256(x) {\n\t  return sha256_S(x, 17) ^ sha256_S(x, 19) ^ sha256_R(x, 10);\n\t};\n\t\n\tfunction binb_sha256(m, l) {\n\t  var HASH = new Array(1779033703, -1150833019, 1013904242, -1521486534, 1359893119, -1694144372, 528734635, 1541459225);\n\t  var W = new Array(64);\n\t  var a, b, c, d, e, f, g, h;\n\t  var i, j, T1, T2;\n\t\n\t  /* append padding */\n\t  m[l >> 5] |= 0x80 << 24 - l % 32;\n\t  m[(l + 64 >> 9 << 4) + 15] = l;\n\t\n\t  for (i = 0; i < m.length; i += 16) {\n\t    a = HASH[0];\n\t    b = HASH[1];\n\t    c = HASH[2];\n\t    d = HASH[3];\n\t    e = HASH[4];\n\t    f = HASH[5];\n\t    g = HASH[6];\n\t    h = HASH[7];\n\t\n\t    for (j = 0; j < 64; j++) {\n\t      if (j < 16) W[j] = m[j + i];else W[j] = safe_add(safe_add(safe_add(sha256_Gamma1256(W[j - 2]), W[j - 7]), sha256_Gamma0256(W[j - 15])), W[j - 16]);\n\t\n\t      T1 = safe_add(safe_add(safe_add(safe_add(h, sha256_Sigma1256(e)), sha256_Ch(e, f, g)), sha256_K[j]), W[j]);\n\t      T2 = safe_add(sha256_Sigma0256(a), sha256_Maj(a, b, c));\n\t      h = g;\n\t      g = f;\n\t      f = e;\n\t      e = safe_add(d, T1);\n\t      d = c;\n\t      c = b;\n\t      b = a;\n\t      a = safe_add(T1, T2);\n\t    }\n\t\n\t    HASH[0] = safe_add(a, HASH[0]);\n\t    HASH[1] = safe_add(b, HASH[1]);\n\t    HASH[2] = safe_add(c, HASH[2]);\n\t    HASH[3] = safe_add(d, HASH[3]);\n\t    HASH[4] = safe_add(e, HASH[4]);\n\t    HASH[5] = safe_add(f, HASH[5]);\n\t    HASH[6] = safe_add(g, HASH[6]);\n\t    HASH[7] = safe_add(h, HASH[7]);\n\t  }\n\t  return HASH;\n\t};\n\t\n\tfunction safe_add(x, y) {\n\t  var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n\t  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n\t  return msw << 16 | lsw & 0xFFFF;\n\t};\n\t\n\t/*! base64x-1.1.3 (c) 2012-2014 Kenji Urushima | kjur.github.com/jsjws/license\n\t */\n\t/*\n\t * base64x.js - Base64url and supplementary functions for Tom Wu's base64.js library\n\t *\n\t * version: 1.1.3 (2014 May 25)\n\t *\n\t * Copyright (c) 2012-2014 Kenji Urushima (kenji.urushima@gmail.com)\n\t *\n\t * This software is licensed under the terms of the MIT License.\n\t * http://kjur.github.com/jsjws/license/\n\t *\n\t * The above copyright and license notice shall be\n\t * included in all copies or substantial portions of the Software.\n\t *\n\t * DEPENDS ON:\n\t *   - base64.js - Tom Wu's Base64 library\n\t */\n\t\n\t/**\n\t * Base64URL and supplementary functions for Tom Wu's base64.js library.<br/>\n\t * This class is just provide information about global functions\n\t * defined in 'base64x.js'. The 'base64x.js' script file provides\n\t * global functions for converting following data each other.\n\t * <ul>\n\t * <li>(ASCII) String</li>\n\t * <li>UTF8 String including CJK, Latin and other characters</li>\n\t * <li>byte array</li>\n\t * <li>hexadecimal encoded String</li>\n\t * <li>Full URIComponent encoded String (such like \"%69%94\")</li>\n\t * <li>Base64 encoded String</li>\n\t * <li>Base64URL encoded String</li>\n\t * </ul>\n\t * All functions in 'base64x.js' are defined in {@link _global_} and not\n\t * in this class.\n\t * Base64URL and supplementary functions for Tom Wu's base64.js library\n\t *\n\t * @class\n\t * @author Kenji Urushima\n\t * @version 1.1 (07 May 2012)\n\t * @requires base64.js\n\t * @see <a href=\"http://kjur.github.com/jsjws/\">'jwjws'(JWS JavaScript Library) home page http://kjur.github.com/jsjws/</a>\n\t * @see <a href=\"http://kjur.github.com/jsrsasigns/\">'jwrsasign'(RSA Sign JavaScript Library) home page http://kjur.github.com/jsrsasign/</a>\n\t */\n\tfunction Base64x() {};\n\t\n\t// ==== base64 / base64url ================================\n\t/**\n\t * convert a Base64 encoded string to a Base64URL encoded string.<br/>\n\t * Example: \"ab+c3f/==\" &rarr; \"ab-c3f_\"\n\t *\n\t * @param {String} s Base64 encoded string\n\t * @return {String} Base64URL encoded string\n\t */\n\tfunction b64tob64u(s) {\n\t  s = s.replace(/\\=/g, '');\n\t  s = s.replace(/\\+/g, '-');\n\t  s = s.replace(/\\//g, '_');\n\t  return s;\n\t};\n\t/* jshint ignore:end */\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _utils = __webpack_require__(1);\n\t\n\tvar utils = _interopRequireWildcard(_utils);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tif (undefined && undefined.Meteor) {\n\t  // NOTE: this only work if it is used with the meteor package version of this library.\n\t\n\t  undefined.Headers = fetch.Headers, undefined.Request = fetch.Request;\n\t\n\t  fetch.Promise = Promise;\n\t}\n\t\n\tvar AuthRequest = function () {\n\t  function AuthRequest(authConfig) {\n\t    _classCallCheck(this, AuthRequest);\n\t\n\t    // Init auth variables\n\t    this.authConfig = authConfig;\n\t  }\n\t\n\t  /////////////////\n\t  // Private API //\n\t  /////////////////\n\t\n\t  /**\n\t   * Creates a credentials object with data stored in this.authconfig\n\t   * and extends it with more authData (if provided)\n\t   *\n\t   * @param  {Object} authData Extended auth data (i.e. user & pass)\n\t   * @param  {String} scope\n\t   * @return {Object}\n\t   */\n\t\n\t\n\t  _createClass(AuthRequest, [{\n\t    key: '_createClaims',\n\t    value: function _createClaims(authData, scope) {\n\t      var _authConfig = this.authConfig;\n\t      var clientId = _authConfig.clientId;\n\t      var iamAUD = _authConfig.iamAUD;\n\t      var scopes = _authConfig.scopes;\n\t      var defaultAuthData = _authConfig.defaultAuthData;\n\t\n\t      var claims = {\n\t        iss: clientId,\n\t        aud: iamAUD,\n\t        scope: scopes[scope]\n\t      };\n\t\n\t      Object.assign(claims, defaultAuthData);\n\t      Object.assign(claims, authData);\n\t\n\t      return claims;\n\t    }\n\t\n\t    /**\n\t     * Generates jwt\n\t     *\n\t     * @param  {Object} claims\n\t     * @param  {String} clientSecret\n\t     * @return {String}\n\t     */\n\t\n\t  }, {\n\t    key: '_generateAssertion',\n\t    value: function _generateAssertion(claims, clientSecret) {\n\t      return utils.jwt.generate(claims, clientSecret);\n\t    }\n\t\n\t    /**\n\t     * Authenticates with composr\n\t     * Uses fetch (or fetch polyfill: https://github.com/github/fetch)\n\t     *\n\t     * @param  {String} endpoint     Endpoint to comunicate with\n\t     * @param  {Object} claims  Credentials data created with _createClaims\n\t     * @param  {Object} headers\n\t     * @return {Object} A result promise\n\t     */\n\t\n\t  }, {\n\t    key: '_authenticate',\n\t    value: function _authenticate(endpoint, claims, headers) {\n\t      var _authConfig2 = this.authConfig;\n\t      var endpoints = _authConfig2.endpoints;\n\t      var urlBase = _authConfig2.urlBase;\n\t      var clientSecret = _authConfig2.clientSecret;\n\t      var defaultHeaders = _authConfig2.defaultHeaders;\n\t\n\t      var url = utils.buildURI(urlBase) + endpoints[endpoint];\n\t      var jwt = this._generateAssertion(claims, clientSecret);\n\t      var body = {\n\t        jwt: jwt\n\t      };\n\t      var authenticationHeaders = {\n\t        'Accept': 'application/json',\n\t        'Content-Type': 'application/json; charset=utf-8'\n\t      };\n\t\n\t      Object.assign(authenticationHeaders, defaultHeaders);\n\t      Object.assign(authenticationHeaders, headers);\n\t\n\t      var headersInstance = new Headers(authenticationHeaders);\n\t\n\t      var request = new Request(url, {\n\t        credentials: 'include',\n\t        mode: 'cors',\n\t        cache: 'no-store',\n\t        method: 'POST',\n\t        headers: headersInstance,\n\t        body: JSON.stringify(body)\n\t      });\n\t\n\t      return fetch(request).then(utils.checkStatus);\n\t    }\n\t\n\t    ////////////////\n\t    // Public API //\n\t    ////////////////\n\t\n\t    /**\n\t     * Authenticates with client scope\n\t     *\n\t     * @return {Object} Promise\n\t     */\n\t\n\t  }, {\n\t    key: 'authenticateClient',\n\t    value: function authenticateClient() {\n\t      var claims = this._createClaims({}, 'client');\n\t\n\t      this.clientAccessTokenPromise = this._authenticate('loginClient', claims);\n\t\n\t      return this.clientAccessTokenPromise;\n\t    }\n\t\n\t    /**\n\t     * Sign in method\n\t     * Calls _authenticate() method with the inserted credentials\n\t     *\n\t     * @return {Object} A result promise\n\t     */\n\t\n\t  }, {\n\t    key: 'authenticateUser',\n\t    value: function authenticateUser(_ref) {\n\t      var email = _ref.email;\n\t      var password = _ref.password;\n\t      var _ref$headersExtension = _ref.headersExtension;\n\t      var headersExtension = _ref$headersExtension === undefined ? {} : _ref$headersExtension;\n\t      var _ref$authDataExtensio = _ref.authDataExtension;\n\t      var authDataExtension = _ref$authDataExtensio === undefined ? {} : _ref$authDataExtensio;\n\t\n\t      var authData = Object.assign({\n\t        'basic_auth.username': email,\n\t        'basic_auth.password': password\n\t      }, authDataExtension);\n\t\n\t      var claims = this._createClaims(authData, 'user');\n\t\n\t      var request = this._authenticate('login', claims, headersExtension);\n\t\n\t      return request;\n\t    }\n\t\n\t    /**\n\t     * Refresh Token method\n\t     * Calls _authenticate() method with the user refresh token provided\n\t     *\n\t     * @return {Object} A result promise\n\t     */\n\t\n\t  }, {\n\t    key: 'refreshUserToken',\n\t    value: function refreshUserToken(_ref2) {\n\t      var refreshToken = _ref2.refreshToken;\n\t      var _ref2$headersExtensio = _ref2.headersExtension;\n\t      var headersExtension = _ref2$headersExtensio === undefined ? {} : _ref2$headersExtensio;\n\t      var _ref2$authDataExtensi = _ref2.authDataExtension;\n\t      var authDataExtension = _ref2$authDataExtensi === undefined ? {} : _ref2$authDataExtensi;\n\t\n\t      var authData = Object.assign({\n\t        'refresh_token': refreshToken\n\t      }, authDataExtension);\n\t\n\t      var claims = this._createClaims(authData, 'user');\n\t\n\t      var request = this._authenticate('refreshToken', claims, headersExtension);\n\t\n\t      return request;\n\t    }\n\t\n\t    /**\n\t     * Logs out method\n\t     * Calls _authenticate() method with provided credentials\n\t     */\n\t\n\t  }, {\n\t    key: 'logoutUser',\n\t    value: function logoutUser(_ref3) {\n\t      var accessToken = _ref3.accessToken;\n\t      var _ref3$headersExtensio = _ref3.headersExtension;\n\t      var headersExtension = _ref3$headersExtensio === undefined ? {} : _ref3$headersExtensio;\n\t      var _ref3$authDataExtensi = _ref3.authDataExtension;\n\t      var authDataExtension = _ref3$authDataExtensi === undefined ? {} : _ref3$authDataExtensi;\n\t\n\t      var headers = Object.assign({\n\t        'Authorization': accessToken\n\t      }, headersExtension);\n\t\n\t      var claims = this._createClaims(authDataExtension, 'user');\n\t\n\t      var request = this._authenticate('logout', claims, headers);\n\t\n\t      return request;\n\t    }\n\t  }]);\n\t\n\t  return AuthRequest;\n\t}();\n\t\n\texports.default = AuthRequest;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar AuthPersist = function () {\n\t  function AuthPersist() {\n\t    var cookies = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\t\n\t    _classCallCheck(this, AuthPersist);\n\t\n\t    this._isNode();\n\t    this.getRememberFromStorage();\n\t    this.getTokensFromStorage();\n\t    this.cookies = cookies;\n\t  }\n\t\n\t  /////////////////\n\t  // Private API //\n\t  /////////////////\n\t\n\t  _createClass(AuthPersist, [{\n\t    key: '_isNode',\n\t    value: function _isNode() {\n\t      var evaluateEnvironment = new Function('try {return window;}catch(e){ return false;}');\n\t\n\t      if (evaluateEnvironment()) {\n\t        this.sessionStorage = window.sessionStorage;\n\t        this.localStorage = window.localStorage;\n\t\n\t        return false;\n\t      }\n\t\n\t      this.sessionStorage = {\n\t        removeItem: function removeItem(item) {\n\t          this[item] = void 0;\n\t        }\n\t      };\n\t\n\t      this.localStorage = {\n\t        removeItem: function removeItem(item) {\n\t          this[item] = void 0;\n\t        }\n\t      };\n\t\n\t      return true;\n\t    }\n\t\n\t    /**\n\t     * Adds data to localStorage\n\t     *\n\t     * @param {Object} data\n\t     */\n\t\n\t  }, {\n\t    key: '_addLocalStorage',\n\t    value: function _addLocalStorage(data) {\n\t      if (this.remember) {\n\t        this.localStorage.remember = true;\n\t        this.localStorage.refreshToken = data.refreshToken;\n\t      }\n\t      if (data.authOptions) {\n\t        this.localStorage.authOptions = JSON.stringify(data.authOptions);\n\t      }\n\t      this.localStorage.scopes = data.scopes;\n\t      this.localStorage.accessToken = data.accessToken;\n\t      this.localStorage.expiresAt = data.expiresAt;\n\t    }\n\t\n\t    /**\n\t     * Adds data to sessionStorage\n\t     *\n\t     * @param {Object} data\n\t     */\n\t\n\t  }, {\n\t    key: '_addSessionStorage',\n\t    value: function _addSessionStorage(data) {\n\t\n\t      if (this.remember) {\n\t        this.sessionStorage.remember = true;\n\t      }\n\t      if (data.authOptions) {\n\t        this.sessionStorage.authOptions = JSON.stringify(data.authOptions);\n\t      }\n\t      this.sessionStorage.scopes = data.scopes;\n\t      this.sessionStorage.refreshToken = data.refreshToken;\n\t      this.sessionStorage.accessToken = data.accessToken;\n\t      this.sessionStorage.expiresAt = data.expiresAt;\n\t    }\n\t\n\t    /**\n\t     * Removes auth data from localStorage\n\t     */\n\t\n\t  }, {\n\t    key: '_removeLocalStorage',\n\t    value: function _removeLocalStorage() {\n\t      var items = ['refreshToken', 'accessToken', 'expiresAt', 'scopes', 'remember', 'authOptions'];\n\t\n\t      for (var i in items) {\n\t        this.localStorage.removeItem(items[i]);\n\t      }\n\t    }\n\t\n\t    /**\n\t     * Removes auth data from sessionStorage\n\t     */\n\t\n\t  }, {\n\t    key: '_removeSessionStorage',\n\t    value: function _removeSessionStorage() {\n\t      var items = ['refreshToken', 'accessToken', 'expiresAt', 'scopes', 'remember', 'authOptions'];\n\t\n\t      for (var i in items) {\n\t        this.sessionStorage.removeItem(items[i]);\n\t      }\n\t    }\n\t  }, {\n\t    key: '_removeUserCookie',\n\t    value: function _removeUserCookie(cookieName) {\n\t      document.cookie = cookieName + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t    }\n\t  }, {\n\t    key: '_removeUserCookies',\n\t    value: function _removeUserCookies() {\n\t      // TODO: Due to an issue with ios 8 or lower versions\n\t      //  it's better to use for..in loops instead for..of\n\t      //\n\t      // Replace following lines in projects without support for this browsers:\n\t      //\n\t      // for (const cookie of this.cookies) {\n\t      //   this._removeUserCookie(cookie);\n\t      // }\n\t      for (var i in this.cookies) {\n\t        var cookie = this.cookies[i];\n\t        this._removeUserCookie(cookie);\n\t      }\n\t    }\n\t  }, {\n\t    key: '_getAuthOptionsFromStorage',\n\t    value: function _getAuthOptionsFromStorage() {\n\t      var authOptions = this.sessionStorage.authOptions || this.localStorage.authOptions;\n\t      try {\n\t        authOptions = JSON.parse(authOptions);\n\t      } catch (err) {\n\t        authOptions = {};\n\t      }\n\t      return authOptions;\n\t    }\n\t  }, {\n\t    key: '_getUserAccessToken',\n\t    value: function _getUserAccessToken() {\n\t      var sessionStorageToken = {\n\t        accessToken: this.sessionStorage.accessToken,\n\t        expiresAt: parseInt(this.sessionStorage.expiresAt)\n\t      };\n\t\n\t      var localStorageToken = {\n\t        accessToken: this.localStorage.accessToken,\n\t        expiresAt: parseInt(this.localStorage.expiresAt)\n\t      };\n\t\n\t      var mostRecentToken = {};\n\t\n\t      if (!isNaN(sessionStorageToken.expiresAt) && !isNaN(localStorageToken.expiresAt)) {\n\t        mostRecentToken = sessionStorageToken.expiresAt > localStorageToken.expiresAt ? sessionStorageToken : localStorageToken;\n\t        return mostRecentToken;\n\t      }\n\t\n\t      mostRecentToken = isNaN(sessionStorageToken.expiresAt) ? localStorageToken : sessionStorageToken;\n\t\n\t      return mostRecentToken;\n\t    }\n\t  }, {\n\t    key: '_getUserTokens',\n\t    value: function _getUserTokens() {\n\t      var refreshToken = this.sessionStorage.refreshToken || this.localStorage.refreshToken;\n\t      var scopes = this.sessionStorage.scopes || this.localStorage.scopes;\n\t\n\t      var _getUserAccessToken2 = this._getUserAccessToken();\n\t\n\t      var accessToken = _getUserAccessToken2.accessToken;\n\t      var expiresAt = _getUserAccessToken2.expiresAt;\n\t\n\t      var userTokens = {\n\t        refreshToken: refreshToken,\n\t        accessToken: accessToken,\n\t        expiresAt: expiresAt,\n\t        scopes: scopes\n\t      };\n\t\n\t      return userTokens;\n\t    }\n\t  }, {\n\t    key: '_getClientAccessToken',\n\t    value: function _getClientAccessToken() {\n\t      var accessToken = this.sessionStorage.clientAccessToken;;\n\t      var expiresAt = this.sessionStorage.clientExpiresAt;\n\t\n\t      return {\n\t        accessToken: accessToken,\n\t        expiresAt: expiresAt\n\t      };\n\t    }\n\t\n\t    ////////////////\n\t    // Public API //\n\t    ////////////////\n\t\n\t    /**\n\t     * Persist client accessToken\n\t     */\n\t\n\t  }, {\n\t    key: 'persistClientToken',\n\t    value: function persistClientToken(_ref) {\n\t      var accessToken = _ref.accessToken;\n\t      var expiresAt = _ref.expiresAt;\n\t\n\t\n\t      this.sessionStorage.clientAccessToken = accessToken;\n\t      this.sessionStorage.clientExpiresAt = expiresAt;\n\t\n\t      this.tokens.client = {\n\t        accessToken: accessToken,\n\t        expiresAt: expiresAt\n\t      };\n\t    }\n\t\n\t    /**\n\t     * Stores result auth data in local & session storage\n\t     *\n\t     * @param  {Object} tokenObject [accessToken, refreshToken, expiresAt, authOptions]\n\t     */\n\t\n\t  }, {\n\t    key: 'persistAuthData',\n\t    value: function persistAuthData(tokenObject) {\n\t      var accessToken = tokenObject.accessToken;\n\t      var refreshToken = tokenObject.refreshToken;\n\t      var expiresAt = tokenObject.expiresAt;\n\t      var scopes = tokenObject.scopes;\n\t      var authOptions = tokenObject.authOptions;\n\t\n\t\n\t      if (this.remember) {\n\t        this._addLocalStorage(tokenObject);\n\t        this._addSessionStorage(tokenObject);\n\t      } else {\n\t        // Not saving in localstorage if user doesnt check remember option\n\t        // When browser is closed, user is logged out\n\t        this._addSessionStorage(tokenObject);\n\t      }\n\t\n\t      this.tokens.user = {\n\t        accessToken: accessToken,\n\t        refreshToken: refreshToken,\n\t        expiresAt: expiresAt,\n\t        scopes: scopes\n\t      };\n\t\n\t      this.tokens.authOptions = authOptions;\n\t\n\t      return true;\n\t    }\n\t  }, {\n\t    key: 'removeAllUserData',\n\t    value: function removeAllUserData() {\n\t      this._removeLocalStorage();\n\t      this._removeSessionStorage();\n\t      this._removeUserCookies();\n\t    }\n\t  }, {\n\t    key: 'getRememberFromStorage',\n\t    value: function getRememberFromStorage() {\n\t      var remember = this.sessionStorage.remember || this.localStorage.remember;\n\t\n\t      this.remember = remember === 'true';\n\t\n\t      return this.remember;\n\t    }\n\t  }, {\n\t    key: 'getTokensFromStorage',\n\t    value: function getTokensFromStorage() {\n\t      var tokens = {\n\t        client: this._getClientAccessToken(),\n\t        user: this._getUserTokens(),\n\t        authOptions: this._getAuthOptionsFromStorage()\n\t      };\n\t      this.tokens = tokens;\n\t\n\t      return tokens;\n\t    }\n\t  }]);\n\t\n\t  return AuthPersist;\n\t}();\n\t\n\texports.default = AuthPersist;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _AuthRequest = __webpack_require__(5);\n\t\n\tvar _AuthRequest2 = _interopRequireDefault(_AuthRequest);\n\t\n\tvar _AuthPersist = __webpack_require__(6);\n\t\n\tvar _AuthPersist2 = _interopRequireDefault(_AuthPersist);\n\t\n\tvar _utils = __webpack_require__(1);\n\t\n\tvar utils = _interopRequireWildcard(_utils);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar AuthConnector = function () {\n\t  function AuthConnector(_ref) {\n\t    var _ref$options = _ref.options;\n\t    var options = _ref$options === undefined ? {} : _ref$options;\n\t    var authConfig = _ref.authConfig;\n\t    var _ref$authPersist = _ref.authPersist;\n\t    var authPersist = _ref$authPersist === undefined ? new _AuthPersist2.default() : _ref$authPersist;\n\t    var _ref$authRequest = _ref.authRequest;\n\t    var authRequest = _ref$authRequest === undefined ? new _AuthRequest2.default(authConfig) : _ref$authRequest;\n\t\n\t    _classCallCheck(this, AuthConnector);\n\t\n\t    this.authPersist = authPersist;\n\t    this.authRequest = authRequest;\n\t    this.options = options;\n\t    this.userAuthenticated = false;\n\t  }\n\t\n\t  /////////////////\n\t  // Private API //\n\t  /////////////////\n\t\n\t  /**\n\t   * Set authentication status and dispatch an event\n\t   */\n\t\n\t\n\t  _createClass(AuthConnector, [{\n\t    key: '_setAuthentication',\n\t    value: function _setAuthentication(auth) {\n\t      utils.events.publish('userAuthenticated', auth);\n\t      this.userAuthenticated = auth;\n\t    }\n\t\n\t    /**\n\t     * Validates accesstoken and refresh if it's necessary\n\t     */\n\t\n\t  }, {\n\t    key: '_validateAccessToken',\n\t    value: function _validateAccessToken() {\n\t      this.authPersist.getTokensFromStorage();\n\t      var _authPersist$tokens$u = this.authPersist.tokens.user;\n\t      var accessToken = _authPersist$tokens$u.accessToken;\n\t      var expiresAt = _authPersist$tokens$u.expiresAt;\n\t      var refreshToken = _authPersist$tokens$u.refreshToken;\n\t\n\t      var validAccessToken = accessToken && expiresAt && Date.now() < expiresAt;\n\t      var accessTokenPromise = void 0;\n\t\n\t      if (validAccessToken) {\n\t        // Accesstoken exists and is not expired\n\t        accessTokenPromise = Promise.resolve({\n\t          accessToken: accessToken\n\t        });\n\t      } else if (refreshToken) {\n\t        // AccessToken expired or missed: refresh token if exists\n\t        accessTokenPromise = this.refreshUserToken();\n\t      } else {\n\t        accessTokenPromise = Promise.reject('No accessToken or refreshToken');\n\t      }\n\t\n\t      return accessTokenPromise;\n\t    }\n\t\n\t    /**\n\t     * Validates if clientAccessToken exists in sessionStorage and is not expired\n\t     *\n\t     * @return {String} clientAccessToken\n\t     */\n\t\n\t  }, {\n\t    key: '_validateClientAccessToken',\n\t    value: function _validateClientAccessToken(clientToken) {\n\t\n\t      var isValid = clientToken && clientToken.accessToken && clientToken.expiresAt && Date.now() < parseInt(clientToken.expiresAt);\n\t\n\t      return isValid ? clientToken : false;\n\t    }\n\t\n\t    /**\n\t     * Parse token object when comes inside another object\n\t     *\n\t     * @param  {Object} response Request response object\n\t     * @return {Object}          Token object\n\t     */\n\t\n\t  }, {\n\t    key: '_parseTokenObject',\n\t    value: function _parseTokenObject(response) {\n\t      if (response.tokenObject) {\n\t        return response.tokenObject;\n\t      }\n\t\n\t      return response;\n\t    }\n\t\n\t    /**\n\t     * Execute optional callbacks\n\t     *\n\t     * @param  {String} name    Name of the event\n\t     * @param  {Object} promise Unresolved event promise\n\t     */\n\t\n\t  }, {\n\t    key: '_executePromiseCb',\n\t    value: function _executePromiseCb(name, promise) {\n\t\n\t      this._publishEvent(name, promise);\n\t\n\t      if (!this.options.callbacks) {\n\t        return;\n\t      }\n\t\n\t      var successCb = void 0;\n\t      var errorCb = void 0;\n\t\n\t      if (this.options.callbacks.success) {\n\t        successCb = this.options.callbacks.success[name];\n\t      }\n\t\n\t      if (this.options.callbacks.error) {\n\t        errorCb = this.options.callbacks.error[name];\n\t      }\n\t\n\t      promise.then(successCb).catch(errorCb);\n\t    }\n\t\n\t    /**\n\t     * Publish events when promises are resolved (use it instead callbacks)\n\t     *\n\t     * @param  {String} name  Name of the event\n\t     * @param  {Object} promise Unresolved event promise\n\t     */\n\t\n\t  }, {\n\t    key: '_publishEvent',\n\t    value: function _publishEvent(name, promise) {\n\t      promise.then(function (res) {\n\t        utils.events.publish(name, {\n\t          result: 'success',\n\t          response: res\n\t        });\n\t      }).catch(function (err) {\n\t        utils.events.publish(name, {\n\t          result: 'error',\n\t          response: err\n\t        });\n\t      });\n\t    }\n\t\n\t    ////////////////\n\t    // Public API //\n\t    ////////////////\n\t\n\t    /**\n\t     * Init method\n\t     * Make a client login and use authValidation method\n\t     * to check if exists a previous valid session\n\t     */\n\t\n\t  }, {\n\t    key: 'init',\n\t    value: function init() {\n\t      var _this = this;\n\t\n\t      this.loginClient();\n\t      this.authValidation().then(function () {\n\t        return _this._setAuthentication(true);\n\t      }).catch(function () {\n\t        return _this._setAuthentication(false);\n\t      });\n\t    }\n\t\n\t    /**\n\t     * Checks if exists a valid user session\n\t     *\n\t     * @return {Object} Promise\n\t     */\n\t\n\t  }, {\n\t    key: 'authValidation',\n\t    value: function authValidation() {\n\t      var _this2 = this;\n\t\n\t      var that = this;\n\t      // Use a previous authValidation promise if it is already pending\n\t      if (this.validationPromise && this._validationState === 'Pending') {\n\t        return this.validationPromise;\n\t      }\n\t\n\t      this._validationState = 'Pending';\n\t\n\t      var validationRequest = this._validateAccessToken();\n\t\n\t      validationRequest.then(function () {\n\t        return _this2._validationState = 'Resolved';\n\t      }).catch(function () {\n\t        return _this2._validationState = 'Resolved';\n\t      });\n\t\n\t      this.validationPromise = validationRequest;\n\t\n\t      return validationRequest;\n\t    }\n\t\n\t    /**\n\t    * Dispatch user accessToken if it's available, if not, dispatch client accessToken\n\t    *\n\t    * @return {Object} Promise\n\t    */\n\t\n\t  }, {\n\t    key: 'getCurrentToken',\n\t    value: function getCurrentToken() {\n\t      var _this3 = this;\n\t\n\t      this.authPersist.getTokensFromStorage();\n\t\n\t      var currentTokenPromise = this.authValidation().then(function () {\n\t        var accessToken = _this3.authPersist.tokens.user.accessToken;\n\t        if (accessToken && _this3.userAuthenticated === false) {\n\t          _this3._setAuthentication(true);\n\t        }\n\t        return accessToken;\n\t      }).catch(function () {\n\t        return _this3.loginClient().then(_this3._parseTokenObject).then(function (res) {\n\t          return res.accessToken;\n\t        });\n\t      });\n\t\n\t      return currentTokenPromise;\n\t    }\n\t\n\t    /**\n\t     * Authenticates with client scope\n\t     *\n\t     * @return {Object} Promise\n\t     */\n\t\n\t  }, {\n\t    key: 'loginClient',\n\t    value: function loginClient() {\n\t      var _this4 = this;\n\t\n\t      this.authPersist.getTokensFromStorage();\n\t      var storedClientToken = this.authPersist.tokens.client;\n\t      var currentClientAccessToken = this._validateClientAccessToken(storedClientToken);\n\t\n\t      // Resolve current clientToken if exists\n\t      if (currentClientAccessToken) {\n\t        return Promise.resolve(currentClientAccessToken);\n\t      }\n\t\n\t      // Ask for a new clientToken\n\t      var clientAccessTokenPromise = this.authRequest.authenticateClient().then(this._parseTokenObject).then(function (res) {\n\t        _this4.authPersist.persistClientToken(res);\n\t        return res;\n\t      });\n\t\n\t      this._executePromiseCb('loginClient', clientAccessTokenPromise);\n\t      this.clientAccessTokenPromise = clientAccessTokenPromise;\n\t\n\t      return clientAccessTokenPromise;\n\t    }\n\t\n\t    /**\n\t     * Sign in method\n\t     *\n\t     * @return {Object} A result promise\n\t     */\n\t\n\t  }, {\n\t    key: 'loginUser',\n\t    value: function loginUser(_ref2) {\n\t      var _this5 = this;\n\t\n\t      var email = _ref2.email;\n\t      var password = _ref2.password;\n\t      var remember = _ref2.remember;\n\t      var _options = this.options;\n\t      var _options$authDataExte = _options.authDataExtension;\n\t      var authDataExtension = _options$authDataExte === undefined ? {} : _options$authDataExte;\n\t      var _options$headersExten = _options.headersExtension;\n\t      var headersExtension = _options$headersExten === undefined ? {} : _options$headersExten;\n\t\n\t\n\t      var request = this.authRequest.authenticateUser({\n\t        email: email,\n\t        password: password,\n\t        remember: remember,\n\t        headersExtension: headersExtension,\n\t        authDataExtension: authDataExtension\n\t      }).then(this._parseTokenObject).then(function (res) {\n\t        res.authOptions = _this5.options;\n\t        _this5.authPersist.remember = remember ? remember : false;\n\t        _this5.authPersist.persistAuthData(res);\n\t        _this5._setAuthentication(true);\n\t\n\t        return res;\n\t      });\n\t\n\t      this._executePromiseCb('loginUser', request);\n\t      this.loginUserPromise = request;\n\t\n\t      return request;\n\t    }\n\t\n\t    /**\n\t     * Refresh token method\n\t     *\n\t     * @return {Object}  A result promise\n\t     */\n\t\n\t  }, {\n\t    key: 'refreshUserToken',\n\t    value: function refreshUserToken() {\n\t      var _this6 = this;\n\t\n\t      this.authPersist.getTokensFromStorage();\n\t\n\t      var refreshToken = this.authPersist.tokens.user.refreshToken;\n\t      var _authPersist$tokens$a = this.authPersist.tokens.authOptions;\n\t      var _authPersist$tokens$a2 = _authPersist$tokens$a.authDataExtension;\n\t      var authDataExtension = _authPersist$tokens$a2 === undefined ? {} : _authPersist$tokens$a2;\n\t      var _authPersist$tokens$a3 = _authPersist$tokens$a.headersExtension;\n\t      var headersExtension = _authPersist$tokens$a3 === undefined ? {} : _authPersist$tokens$a3;\n\t\n\t\n\t      var request = this.authRequest.refreshUserToken({\n\t        refreshToken: refreshToken,\n\t        headersExtension: headersExtension,\n\t        authDataExtension: authDataExtension\n\t      }).then(this._parseTokenObject).then(function (res) {\n\t        _this6.authPersist.persistAuthData(res);\n\t        _this6._setAuthentication(true);\n\t\n\t        return res;\n\t      });\n\t\n\t      this._executePromiseCb('refreshUserToken', request);\n\t      this.refreshUserTokenPromise = request;\n\t\n\t      return request;\n\t    }\n\t\n\t    /**\n\t     * Logout method\n\t     * Calls _authenticate() method\n\t     */\n\t\n\t  }, {\n\t    key: 'logoutUser',\n\t    value: function logoutUser() {\n\t      this.authPersist.getTokensFromStorage();\n\t\n\t      var accessToken = this.authPersist.tokens.user.accessToken;\n\t      var _authPersist$tokens$a4 = this.authPersist.tokens.authOptions;\n\t      var _authPersist$tokens$a5 = _authPersist$tokens$a4.authDataExtension;\n\t      var authDataExtension = _authPersist$tokens$a5 === undefined ? {} : _authPersist$tokens$a5;\n\t      var _authPersist$tokens$a6 = _authPersist$tokens$a4.headersExtension;\n\t      var headersExtension = _authPersist$tokens$a6 === undefined ? {} : _authPersist$tokens$a6;\n\t\n\t\n\t      var request = this.authRequest.logoutUser({\n\t        accessToken: accessToken,\n\t        headersExtension: headersExtension,\n\t        authDataExtension: authDataExtension\n\t      });\n\t\n\t      this._setAuthentication(false);\n\t      this.authPersist.removeAllUserData();\n\t      this._executePromiseCb('logoutUser', request);\n\t\n\t      return request;\n\t    }\n\t  }]);\n\t\n\t  return AuthConnector;\n\t}();\n\t\n\texports.default = AuthConnector;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _AuthConnector = __webpack_require__(7);\n\t\n\tvar _AuthConnector2 = _interopRequireDefault(_AuthConnector);\n\t\n\tvar _utils = __webpack_require__(1);\n\t\n\tvar utils = _interopRequireWildcard(_utils);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tif (undefined && undefined.Meteor) {\n\t  // NOTE: this only work if it is used with the meteor package version of this library.\n\t\n\t  undefined.Headers = fetch.Headers;\n\t  undefined.Request = fetch.Request;\n\t\n\t  fetch.Promise = Promise;\n\t}\n\t\n\tvar Connect = function () {\n\t  function Connect(_ref) {\n\t    var config = _ref.config;\n\t    var _ref$options = _ref.options;\n\t    var options = _ref$options === undefined ? {} : _ref$options;\n\t    var _ref$authConnector = _ref.authConnector;\n\t    var authConnector = _ref$authConnector === undefined ? new _AuthConnector2.default({\n\t      authConfig: config\n\t    }) : _ref$authConnector;\n\t\n\t    _classCallCheck(this, Connect);\n\t\n\t    this.authConnector = authConnector;\n\t    this.endpoints = config.endpoints;\n\t    this.urlBase = config.urlBase;\n\t    this.options = options;\n\t\n\t    this._requestDataQueue = [];\n\t\n\t    this.authConnector.init();\n\t  }\n\t\n\t  /////////////////\n\t  // Private API //\n\t  /////////////////\n\t\n\t  _createClass(Connect, [{\n\t    key: '_buildHeaders',\n\t    value: function _buildHeaders(_ref2) {\n\t      var token = _ref2.token;\n\t      var headersExtension = _ref2.headersExtension;\n\t\n\t      var defaultHeaders = {\n\t        'Accept': 'application/json',\n\t        'Content-Type': 'application/json; charset=utf-8',\n\t        'Authorization': 'Bearer ' + token\n\t      };\n\t\n\t      var headers = Object.assign(defaultHeaders, this.options.headersExtension, headersExtension);\n\t\n\t      return new Headers(headers);\n\t    }\n\t  }, {\n\t    key: '_buildRequestParams',\n\t    value: function _buildRequestParams(_ref3) {\n\t      var body = _ref3.body;\n\t      var queryParams = _ref3.queryParams;\n\t\n\t      var queryPath = this._buildQueryPath(queryParams);\n\t\n\t      if (body) {\n\t        body = JSON.stringify(body);\n\t      }\n\t\n\t      return {\n\t        body: body,\n\t        queryPath: queryPath\n\t      };\n\t    }\n\t  }, {\n\t    key: '_buildQueryPath',\n\t    value: function _buildQueryPath(dict) {\n\t      var query = '';\n\t      if (dict) {\n\t        var queries = [];\n\t        Object.keys(dict).forEach(function (key) {\n\t          queries.push(key + '=' + dict[key]);\n\t        });\n\t        if (queries.length > 0) {\n\t          query = '?' + queries.join('&');\n\t        }\n\t      }\n\t      return query;\n\t    }\n\t  }, {\n\t    key: '_buildUrl',\n\t    value: function _buildUrl(_ref4) {\n\t      var endpoint = _ref4.endpoint;\n\t      var queryPath = _ref4.queryPath;\n\t\n\t      var requestEndpoint = this.endpoints[endpoint];\n\t\n\t      if (endpoint.key) {\n\t        requestEndpoint = this.endpoints[endpoint.key] + endpoint.id;\n\t      }\n\t\n\t      var url = utils.buildURI(this.urlBase) + requestEndpoint + queryPath;\n\t\n\t      return url;\n\t    }\n\t  }, {\n\t    key: '_buildRequest',\n\t    value: function _buildRequest(_ref5, token) {\n\t      var endpoint = _ref5.endpoint;\n\t      var method = _ref5.method;\n\t      var params = _ref5.params;\n\t      var data = _ref5.data;\n\t      var headersExtension = _ref5.headersExtension;\n\t\n\t      var _buildRequestParams2 = this._buildRequestParams({\n\t        queryParams: params,\n\t        body: data\n\t      });\n\t\n\t      var body = _buildRequestParams2.body;\n\t      var queryPath = _buildRequestParams2.queryPath;\n\t\n\t      var url = this._buildUrl({\n\t        endpoint: endpoint,\n\t        queryPath: queryPath\n\t      });\n\t      var headers = this._buildHeaders({\n\t        token: token,\n\t        headersExtension: headersExtension\n\t      });\n\t\n\t      var request = new Request(url, {\n\t        credentials: 'include',\n\t        mode: 'cors',\n\t        cache: 'no-store',\n\t        method: method,\n\t        headers: headers,\n\t        body: body\n\t      });\n\t\n\t      return fetch(request).then(utils.checkStatus);\n\t    }\n\t  }, {\n\t    key: '_createRetryRequests',\n\t    value: function _createRetryRequests(tokenObject) {\n\t      var accessToken = tokenObject.accessToken;\n\t\n\t      var requestDataQueue = void 0;\n\t      var requestsCallback = void 0;\n\t      var retryRequests = [];\n\t\n\t      if (this.options.retryRequestProxy) {\n\t        var retryRequestProxyResponse = this.options.retryRequestProxy(tokenObject, this._requestDataQueue);\n\t        requestDataQueue = retryRequestProxyResponse.requestDataQueue;\n\t        requestsCallback = retryRequestProxyResponse.requestsCallback;\n\t      } else {\n\t        requestDataQueue = this._requestDataQueue;\n\t        requestsCallback = function requestsCallback(data) {\n\t          return data;\n\t        };\n\t      }\n\t\n\t      // TODO: Due to an issue with ios 8 or lower versions\n\t      //  it's better to use for..in loops instead for..of\n\t      //\n\t      // Replace following lines in projects without support for this browsers:\n\t      //\n\t      // for (const data of requestDataQueue) {\n\t      //   const request = this._buildRequest(data, accessToken);\n\t      //\n\t      //   retryRequests.push(request);\n\t      // }\n\t      for (var i in requestDataQueue) {\n\t        var data = requestDataQueue[i];\n\t        var request = this._buildRequest(data, accessToken);\n\t\n\t        retryRequests.push(request);\n\t      }\n\t\n\t      this._requestDataQueue = [];\n\t\n\t      return Promise.all(retryRequests).then(requestsCallback);\n\t    }\n\t  }, {\n\t    key: '_retry',\n\t    value: function _retry(requestData) {\n\t      var _this = this;\n\t\n\t      this._requestDataQueue.push(requestData);\n\t\n\t      if (this._retryStatus === 'Pending') {\n\t        return this._retryRequest;\n\t      }\n\t\n\t      this._retryStatus = 'Pending';\n\t\n\t      var refreshTokenPromise = this.authConnector.refreshUserToken();\n\t      this._retryRequest = refreshTokenPromise.then(function (tokenObject) {\n\t        return _this._createRetryRequests(tokenObject);\n\t      });\n\t\n\t      refreshTokenPromise.then(function () {\n\t        return _this._retryStatus = 'Resolved';\n\t      }).catch(function () {\n\t        return _this._retryStatus = 'Resolved';\n\t      });\n\t\n\t      return this._retryRequest;\n\t    }\n\t\n\t    /**\n\t     * Send request\n\t     *\n\t     * @param  {Object} requestData\n\t     * @return {Object} Promise\n\t     */\n\t\n\t  }, {\n\t    key: '_request',\n\t    value: function _request(requestData) {\n\t      var _this2 = this;\n\t\n\t      var retry = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\t\n\t      var fetchRequest = this.authConnector.getCurrentToken().then(function (token) {\n\t        var request = _this2._buildRequest(requestData, token);\n\t\n\t        return request;\n\t      }).catch(function (err) {\n\t        if (retry && err.status === 401 && _this2.authConnector.userAuthenticated) {\n\t          return _this2._retry(requestData);\n\t        }\n\t\n\t        throw err;\n\t      });\n\t\n\t      return fetchRequest;\n\t    }\n\t\n\t    ////////////////\n\t    // Public API //\n\t    ////////////////\n\t\n\t    /**\n\t     * Send request through proxy\n\t     *\n\t     * @param  {Object} requestData\n\t     * @return {Object} Promise\n\t     */\n\t\n\t  }, {\n\t    key: 'request',\n\t    value: function request(requestData) {\n\t      var retry = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\t\n\t\n\t      if (this.options.requestProxy) {\n\t        var requestProxy = this.options.requestProxy;\n\t        return requestProxy(this._request, requestData, retry);\n\t      }\n\t\n\t      return this._request(requestData, retry);\n\t    }\n\t\n\t    /**\n\t     * GET request\n\t     *\n\t     * @param  {String} endpoint\n\t     * @param  {Object} params\n\t     * @return {Object}  Request promise\n\t     */\n\t\n\t  }, {\n\t    key: 'get',\n\t    value: function get(endpoint, params) {\n\t      var requestData = {\n\t        method: 'get',\n\t        endpoint: endpoint,\n\t        params: params\n\t      };\n\t\n\t      return this.request(requestData);\n\t    }\n\t\n\t    /**\n\t     * DELETE request\n\t     *\n\t     * @param  {String} endpoint\n\t     * @param  {Object} params\n\t     * @return {Object}  Request promise\n\t     */\n\t\n\t  }, {\n\t    key: 'delete',\n\t    value: function _delete(endpoint, params) {\n\t      var requestData = {\n\t        method: 'delete',\n\t        endpoint: endpoint,\n\t        params: params\n\t      };\n\t\n\t      return this.request(requestData);\n\t    }\n\t\n\t    /**\n\t     * POST request\n\t     *\n\t     * @param  {String} endpoint\n\t     * @param  {Object} data\n\t     * @return {Object}  Request promise\n\t     */\n\t\n\t  }, {\n\t    key: 'post',\n\t    value: function post(endpoint, data) {\n\t      var requestData = {\n\t        method: 'post',\n\t        endpoint: endpoint,\n\t        data: data\n\t      };\n\t\n\t      return this.request(requestData);\n\t    }\n\t\n\t    /**\n\t     * PUT request\n\t     *\n\t     * @param  {String} endpoint\n\t     * @param  {Object} data\n\t     * @return {Object}  Request promise\n\t     */\n\t\n\t  }, {\n\t    key: 'put',\n\t    value: function put(endpoint, data) {\n\t      var requestData = {\n\t        method: 'put',\n\t        endpoint: endpoint,\n\t        data: data\n\t      };\n\t\n\t      return this.request(requestData);\n\t    }\n\t  }]);\n\t\n\t  return Connect;\n\t}();\n\t\n\texports.default = Connect;\n\n/***/ }\n/******/ ])\n});\n;\n//# sourceMappingURL=composr-connector.js.map"],"sourceRoot":"/source/"}